<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Golden Dragon</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --bg-color: var(--tg-theme-bg-color, #ffffff);
            --text-color: var(--tg-theme-text-color, #000000);
            --hint-color: var(--tg-theme-hint-color, #999999);
            --button-color: var(--tg-theme-button-color, #40a7e3);
            --button-text-color: var(--tg-theme-button-text-color, #ffffff);
            --secondary-bg-color: var(--tg-theme-secondary-bg-color, #f4f4f5);
            --accent-color: #d4af37;
            --accent-light: rgba(64, 167, 227, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }
        
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            padding: 16px;
            padding-bottom: 80px;
            line-height: 1.5;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .header img {
            height: 40px;
            object-fit: contain;
        }
        
        .customer-code {
            background: var(--secondary-bg-color);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .card {
            background-color: var(--secondary-bg-color);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 16px;
        }
        
        .card-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .stats-grid {
            display: flex;
            gap: 12px;
            margin: 20px 0;
        }
        
        .stat-item {
            flex: 1;
            background: var(--bg-color);
            border-radius: 16px;
            padding: 16px 8px;
            text-align: center;
        }
        
        .stat-icon {
            font-size: 24px;
            margin-bottom: 8px;
            color: var(--accent-color);
        }
        
        .stat-value {
            font-size: 22px;
            font-weight: 700;
        }
        
        .stat-label {
            font-size: 12px;
            color: var(--hint-color);
        }
        
        .button {
            background-color: var(--button-color);
            color: var(--button-text-color);
            border: none;
            border-radius: 14px;
            padding: 16px;
            font-size: 16px;
            font-weight: 600;
            width: 100%;
            cursor: pointer;
            transition: opacity 0.2s;
            margin-top: 16px;
        }
        
        .button.small {
            padding: 12px 16px;
            font-size: 14px;
            width: 100%;
            margin-top: 0;
            text-align: left;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .button:hover {
            opacity: 0.9;
        }
        
        .currency-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 12px;
        }
        
        .currency-table th {
            text-align: left;
            padding: 12px 8px;
            color: var(--hint-color);
            font-weight: 500;
            font-size: 14px;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }
        
        .currency-table td {
            padding: 12px 8px;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }
        
        .currency-flag {
            font-size: 20px;
            margin-right: 8px;
        }
        
        .tab-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--bg-color);
            border-top: 1px solid rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-around;
            padding: 10px 0 12px;
            backdrop-filter: blur(10px);
            z-index: 10;
        }
        
        .tab-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            color: var(--hint-color);
            font-size: 12px;
            cursor: pointer;
            transition: color 0.2s;
            flex: 1;
        }
        
        .tab-item.active {
            color: var(--button-color);
        }
        
        .tab-icon {
            font-size: 24px;
        }
        
        .services-container {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .featured-service {
            background: var(--secondary-bg-color);
            border-radius: 20px;
            padding: 24px;
            cursor: pointer;
            transition: transform 0.1s, border-color 0.2s;
            border: 2px solid var(--accent-color);
            text-align: center;
        }
        
        .featured-service:active {
            transform: scale(0.98);
        }
        
        .featured-service .service-icon {
            font-size: 48px;
            color: var(--accent-color);
            margin-bottom: 12px;
        }
        
        .featured-service .service-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
        }
        
        .featured-service .service-desc {
            font-size: 14px;
            color: var(--hint-color);
        }
        
        .services-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        
        .service-card {
            background: var(--secondary-bg-color);
            border-radius: 16px;
            padding: 16px;
            cursor: pointer;
            transition: transform 0.1s;
            border: 1px solid transparent;
        }
        
        .service-card:active {
            transform: scale(0.98);
            border-color: var(--accent-color);
        }
        
        .service-card .service-icon {
            font-size: 28px;
            margin-bottom: 10px;
            color: var(--accent-color);
        }
        
        .service-card .service-title {
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .service-card .service-desc {
            font-size: 13px;
            color: var(--hint-color);
        }
        
        .input-group {
            margin-bottom: 16px;
        }
        
        .input-label {
            display: block;
            font-size: 14px;
            color: var(--hint-color);
            margin-bottom: 6px;
        }
        
        .input-field, .input-select {
            width: 100%;
            padding: 16px;
            border: 1px solid rgba(0,0,0,0.05);
            border-radius: 16px;
            font-size: 16px;
            background: var(--bg-color);
            color: var(--text-color);
        }
        
        .input-select {
            appearance: none;
            background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23999' stroke-width='2'><polyline points='6 9 12 15 18 9'/></svg>");
            background-repeat: no-repeat;
            background-position: right 16px center;
        }
        
        .converter-block {
            background: var(--secondary-bg-color);
            border-radius: 20px;
            padding: 20px;
            margin-top: 16px;
        }
        
        .converter-row {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }
        
        .converter-amount {
            flex: 2;
        }
        
        .converter-currency {
            flex: 1;
        }
        
        .converter-equal {
            text-align: center;
            font-size: 20px;
            color: var(--hint-color);
            margin: 8px 0;
        }
        
        .profile-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 24px;
        }
        
        .profile-avatar {
            width: 60px;
            height: 60px;
            border-radius: 30px;
            background: var(--accent-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            color: white;
            cursor: pointer;
        }
        
        .profile-info h2 {
            font-size: 22px;
            font-weight: 600;
        }
        
        .profile-info p {
            color: var(--hint-color);
        }
        
        .profile-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 24px;
        }
        
        .profile-grid-item {
            background: var(--secondary-bg-color);
            border-radius: 16px;
            padding: 16px 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .profile-grid-item:hover {
            background: var(--accent-light);
        }
        
        .profile-grid-item i {
            font-size: 24px;
            color: var(--accent-color);
            margin-bottom: 8px;
        }
        
        .profile-grid-item span {
            display: block;
            font-weight: 600;
        }
        
        .profile-menu-item {
            display: flex;
            align-items: center;
            padding: 16px;
            background: var(--secondary-bg-color);
            border-radius: 16px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .profile-menu-item:hover {
            background: var(--accent-light);
        }
        
        .profile-menu-item i {
            width: 24px;
            font-size: 18px;
            color: var(--accent-color);
            margin-right: 16px;
        }
        
        .support-section {
            margin-top: 24px;
        }
        
        .support-title {
            font-weight: 600;
            margin-bottom: 12px;
        }
        
        .back-button {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 20px;
            cursor: pointer;
            color: var(--button-color);
            font-weight: 600;
        }
        
        .back-button.services-back {
            margin-top: 0;
            margin-bottom: 16px;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .page-content {
            display: none;
        }
        
        .page-content.active {
            display: block;
        }
        
        .currency-switch {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }
        
        .currency-switch button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 30px;
            background: var(--secondary-bg-color);
            color: var(--text-color);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .currency-switch button.active {
            background: var(--button-color);
            color: var(--button-text-color);
        }
        
        .avatar-selector {
            display: flex;
            gap: 16px;
            justify-content: center;
            margin: 20px 0;
        }
        
        .avatar-option {
            width: 70px;
            height: 70px;
            border-radius: 35px;
            background: var(--secondary-bg-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.2s;
        }
        
        .avatar-option.selected {
            border-color: var(--button-color);
            background: var(--accent-light);
        }
        
        .service-payment-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 20px;
        }
        
        .payment-option-button {
            background: var(--bg-color);
            border: 2px solid var(--accent-color);
            border-radius: 16px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
            width: 100%;
        }
        
        .payment-option-button:active {
            transform: scale(0.98);
            background-color: var(--accent-color);
            color: white;
        }
        
        .payment-option-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .payment-option-price {
            color: var(--accent-color);
            font-size: 20px;
        }
        
        .payment-option-desc {
            font-size: 14px;
            color: var(--hint-color);
        }
        
        .payment-option-button:active .payment-option-price,
        .payment-option-button:active .payment-option-desc {
            color: white;
        }
        
        .service-desc-text {
            white-space: pre-line;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <img src="img/logo.png" alt="Golden Dragon" onerror="this.src='https://via.placeholder.com/120x40?text=Golden+Dragon'">
            <div class="customer-code" id="customerCode">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </div>

        <!-- –ì–ª–∞–≤–Ω–∞—è -->
        <div id="homeTab" class="tab-content active">
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                    <span style="font-size: 20px; font-weight: 600;" id="greeting">üëã –ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    <span style="color: var(--hint-color);">–ë–∞–ª–∞–Ω—Å: <strong id="balance">0 ‚ÇΩ</strong></span>
                </div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-icon">üì¶</div>
                        <div class="stat-value" id="ordersCount">0</div>
                        <div class="stat-label">–ó–∞–∫–∞–∑—ã</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon">‚úÖ</div>
                        <div class="stat-value" id="deliveredCount">0</div>
                        <div class="stat-label">–î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon">üí∞</div>
                        <div class="stat-value" id="totalToPay">0 $</div>
                        <div class="stat-label">–ö –æ–ø–ª–∞—Ç–µ</div>
                    </div>
                </div>
                <button class="button" id="myOrdersBtn">üìã –ú–æ–∏ –∑–∞–∫–∞–∑—ã</button>
            </div>
            <div class="card">
                <div class="card-title">üí± –ö—É—Ä—Å –≤–∞–ª—é—Ç</div>
                <table class="currency-table">
                    <thead>
                        <tr>
                            <th>–í–∞–ª—é—Ç–∞</th>
                            <th>–ü–æ–∫—É–ø–∫–∞</th>
                            <th>–ü—Ä–æ–¥–∞–∂–∞</th>
                        </tr>
                    </thead>
                    <tbody id="currencyRatesTable"></tbody>
                </table>
            </div>
        </div>

        <!-- –£—Å–ª—É–≥–∏ -->
        <div id="servicesTab" class="tab-content">
            <!-- –ö–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥ –±—É–¥–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ –¥–µ—Ç–∞–ª—å–Ω–æ–π —É—Å–ª—É–≥–∏ -->
            <div id="servicesBackButton" class="back-button services-back" style="display: none;" onclick="showServicesList()">
                <i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥ –∫ —É—Å–ª—É–≥–∞–º
            </div>
            
            <!-- –°–ø–∏—Å–æ–∫ —É—Å–ª—É–≥ -->
            <div id="servicesList">
                <h2 style="margin-bottom: 16px;">üöö –ù–∞—à–∏ —É—Å–ª—É–≥–∏</h2>
                <div class="services-container">
                    <!-- –§—É–ª—Ñ–∏–ª–º–µ–Ω—Ç –∫–∞–∫ –±–æ–ª—å—à–∞—è –∫–Ω–æ–ø–∫–∞ -->
                    <div class="featured-service" id="fulfillmentService">
                        <div class="service-icon">üì¶</div>
                        <div class="service-title">–§—É–ª—Ñ–∏–ª–º–µ–Ω—Ç</div>
                        <div class="service-desc">–ü–æ–ª–Ω—ã–π –∫–æ–º–ø–ª–µ–∫—Å —É—Å–ª—É–≥: –ø—Ä–∏—ë–º, —Ö—Ä–∞–Ω–µ–Ω–∏–µ, —É–ø–∞–∫–æ–≤–∫–∞, –æ—Ç–ø—Ä–∞–≤–∫–∞</div>
                    </div>
                    
                    <!-- –û—Å—Ç–∞–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏ —Å–µ—Ç–∫–æ–π -->
                    <div class="services-grid" id="servicesGrid"></div>
                </div>
            </div>
            
            <!-- –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Å–ª—É–≥–µ -->
            <div id="serviceDetail" style="display: none;">
                <h2 id="serviceDetailTitle"></h2>
                <div class="card" id="serviceDetailDesc"></div>
                <div id="servicePaymentOptions" class="service-payment-options"></div>
            </div>
        </div>

        <!-- –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä -->
        <div id="calcTab" class="tab-content">
            <h2 style="margin-bottom: 16px;">üßÆ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¥–æ—Å—Ç–∞–≤–∫–∏</h2>
            <div class="card">
                <div class="input-group">
                    <label class="input-label">–°—Ç—Ä–∞–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∏</label>
                    <select class="input-select" id="deliveryCountry">
                        <option value="ru">–†–æ—Å—Å–∏—è</option>
                        <option value="tj">–¢–∞–¥–∂–∏–∫–∏—Å—Ç–∞–Ω</option>
                        <option value="kz">–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω</option>
                        <option value="uz">–£–∑–±–µ–∫–∏—Å—Ç–∞–Ω</option>
                    </select>
                </div>
                <div class="input-group">
                    <label class="input-label">–¢–∏–ø —Ç–æ–≤–∞—Ä–∞</label>
                    <select class="input-select" id="goodsType">
                        <option value="1.0">–û–±—ã—á–Ω—ã–π (1.0x)</option>
                        <option value="1.2">–•—Ä—É–ø–∫–∏–π (1.2x)</option>
                        <option value="0.9">–û–¥–µ–∂–¥–∞ (0.9x)</option>
                        <option value="1.5">–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞ (1.5x)</option>
                    </select>
                </div>
                <div class="input-group">
                    <label class="input-label">–í–µ—Å (–∫–≥)</label>
                    <input type="number" class="input-field" id="weight" value="5" step="0.1">
                </div>
                <div class="input-group">
                    <label class="input-label">–û–±—ä—ë–º (–º¬≥) - –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ</label>
                    <input type="number" class="input-field" id="volume" step="0.01">
                </div>
                <div class="input-group">
                    <label class="input-label">–°—Ç–æ–∏–º–æ—Å—Ç—å –≥—Ä—É–∑–∞ ($)</label>
                    <input type="number" class="input-field" id="cargoValue" value="0" step="0.01">
                </div>
                <div class="input-group">
                    <label class="input-label">–°–ø–æ—Å–æ–± –¥–æ—Å—Ç–∞–≤–∫–∏</label>
                    <select class="input-select" id="deliveryMethod">
                        <option value="avia">–ê–≤–∏–∞</option>
                        <option value="auto">–ê–≤—Ç–æ</option>
                        <option value="rail">–ñ/–î</option>
                    </select>
                </div>
                <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 16px;">
                    <input type="checkbox" id="insurance"> <span>–°—Ç—Ä–∞—Ö–æ–≤–∫–∞ (1% –æ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –≥—Ä—É–∑–∞)</span>
                </label>
                <button class="button" onclick="calculateDelivery()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
                <div id="calcResult" style="margin-top: 20px; font-size: 20px; font-weight: 700; text-align: center;"></div>
            </div>
        </div>

        <!-- –í–∞–ª—é—Ç–∞ (—Å –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä–æ–º) -->
        <div id="currencyTab" class="tab-content">
            <div class="currency-switch">
                <button id="showRatesBtn" class="active">–í–∞–ª—é—Ç—ã</button>
                <button id="showConverterBtn">–ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä</button>
            </div>
            <div id="ratesSection">
                <div class="card" style="max-height: 400px; overflow-y: auto;">
                    <table class="currency-table">
                        <thead>
                            <tr>
                                <th>–í–∞–ª—é—Ç–∞</th>
                                <th>–ü–æ–∫—É–ø–∫–∞</th>
                                <th>–ü—Ä–æ–¥–∞–∂–∞</th>
                            </tr>
                        </thead>
                        <tbody id="allRatesTable"></tbody>
                    </table>
                </div>
            </div>
            <div id="converterSection" style="display: none;">
                <div class="converter-block">
                    <div class="converter-row">
                        <div class="converter-amount">
                            <label class="input-label">–£ –≤–∞—Å –µ—Å—Ç—å</label>
                            <input type="number" id="fromAmount" class="input-field" value="1" step="0.01">
                        </div>
                        <div class="converter-currency">
                            <label class="input-label">–í–∞–ª—é—Ç–∞</label>
                            <select id="fromCurrency" class="input-select"></select>
                        </div>
                    </div>
                    <div class="converter-equal">‚âà</div>
                    <div class="converter-row">
                        <div class="converter-amount">
                            <label class="input-label">–£ –≤–∞—Å –±—É–¥–µ—Ç</label>
                            <input type="number" id="toAmount" class="input-field" readonly value="0">
                        </div>
                        <div class="converter-currency">
                            <label class="input-label">–í–∞–ª—é—Ç–∞</label>
                            <select id="toCurrency" class="input-select"></select>
                        </div>
                    </div>
                    <p id="converterRate" style="text-align: center; margin-top: 16px; color: var(--hint-color);"></p>
                </div>
            </div>
        </div>

        <!-- –ü—Ä–æ—Ñ–∏–ª—å -->
        <div id="profileTab" class="tab-content">
            <div id="profileMenu" class="page-content active">
                <div class="profile-header">
                    <div class="profile-avatar" id="profileAvatar">üë§</div>
                    <div class="profile-info">
                        <h2 id="profileName">–ó–∞–≥—Ä—É–∑–∫–∞...</h2>
                        <p id="profileCode">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                    </div>
                </div>
                <div class="profile-grid">
                    <div class="profile-grid-item" data-page="orders"><i class="fas fa-box"></i><span>–ó–∞–∫–∞–∑—ã</span></div>
                    <div class="profile-grid-item" data-page="history"><i class="fas fa-history"></i><span>–ò—Å—Ç–æ—Ä–∏—è</span></div>
                    <div class="profile-grid-item" data-page="account"><i class="fas fa-wallet"></i><span>–ë–∞–ª–∞–Ω—Å</span></div>
                </div>
                <div class="profile-menu-item" data-page="pickup"><i class="fas fa-map-marker-alt"></i> –ü—É–Ω–∫—Ç—ã –≤—ã–¥–∞—á–∏</div>
                <div class="profile-menu-item" data-page="calculator"><i class="fas fa-calculator"></i> –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</div>
                <div class="profile-menu-item" data-page="settings"><i class="fas fa-cog"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
                <div class="support-section">
                    <div class="support-title">–¶–µ–Ω—Ç—Ä –ø–æ–¥–¥–µ—Ä–∂–∫–∏</div>
                    <div class="profile-menu-item" data-page="contact"><i class="fas fa-headset"></i> –°–≤—è–∑–∞—Ç—å—Å—è —Å –Ω–∞–º–∏</div>
                    <div class="profile-menu-item" data-page="prohibited"><i class="fas fa-ban"></i> –ó–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã</div>
                </div>
            </div>

            <!-- –°—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–æ—Ñ–∏–ª—è -->
            <div id="ordersPage" class="page-content">
                <div class="back-button" onclick="showProfileMenu()"><i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥</div>
                <h2>üì¶ –ú–æ–∏ –∑–∞–∫–∞–∑—ã</h2>
                <div id="ordersList" class="card">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            </div>
            <div id="historyPage" class="page-content">
                <div class="back-button" onclick="showProfileMenu()"><i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥</div>
                <h2>üìä –ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π</h2>
                <div class="card">–ò—Å—Ç–æ—Ä–∏—è –ø–æ—è–≤–∏—Ç—Å—è –ø–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è API</div>
            </div>
            <div id="accountPage" class="page-content">
                <div class="back-button" onclick="showProfileMenu()"><i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥</div>
                <h2>üí∞ –ë–∞–ª–∞–Ω—Å</h2>
                <div class="card">
                    <div style="font-size: 24px; font-weight: 700; text-align: center; margin-bottom: 20px;" id="accountBalance">0 ‚ÇΩ</div>
                    <button class="button" onclick="showBalanceRecharge()">‚ûï –ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å</button>
                </div>
            </div>
            <div id="rechargePage" class="page-content">
                <div class="back-button" onclick="showProfilePage('accountPage')"><i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥</div>
                <h2>üí∞ –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞</h2>
                <div class="card">
                    <div class="input-group">
                        <label class="input-label">–°—É–º–º–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è (‚ÇΩ)</label>
                        <input type="number" class="input-field" id="rechargeAmount" value="100" step="1" min="1">
                    </div>
                    <p style="margin-bottom: 16px; color: var(--hint-color);">–í —Ç–µ—Å—Ç–æ–≤–æ–º —Ä–µ–∂–∏–º–µ –±–∞–ª–∞–Ω—Å –ø–æ–ø–æ–ª–Ω—è–µ—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –ø–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏.</p>
                    <button class="button" onclick="rechargeBalance()">‚úÖ –ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
                </div>
            </div>
            <div id="pickupPage" class="page-content">
                <div class="back-button" onclick="showProfileMenu()"><i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥</div>
                <h2>üìç –ü—É–Ω–∫—Ç—ã –≤—ã–¥–∞—á–∏</h2>
                <div id="pickupList" class="card"></div>
            </div>
            <div id="calculatorPage" class="page-content">
                <div class="back-button" onclick="showProfileMenu()"><i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥</div>
                <h2>üßÆ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</h2>
                <div class="card">–ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É "–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä" –≤–Ω–∏–∑—É.</div>
            </div>
            <div id="settingsPage" class="page-content">
                <div class="back-button" onclick="showProfileMenu()"><i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥</div>
                <h2>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
                <div class="card">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div class="profile-avatar" id="settingsAvatar" style="width: 80px; height: 80px; font-size: 40px; margin: 0 auto;">üë§</div>
                        <div class="avatar-selector">
                            <div class="avatar-option" data-avatar="üë§" onclick="selectAvatar('üë§')">üë§</div>
                            <div class="avatar-option" data-avatar="üê±" onclick="selectAvatar('üê±')">üê±</div>
                            <div class="avatar-option" data-avatar="ü¶ä" onclick="selectAvatar('ü¶ä')">ü¶ä</div>
                            <div class="avatar-option" data-avatar="üêº" onclick="selectAvatar('üêº')">üêº</div>
                        </div>
                    </div>
                    <div class="input-group">
                        <label class="input-label">–ò–º—è</label>
                        <input type="text" id="settingsName" class="input-field" value="">
                    </div>
                    <div class="input-group">
                        <label class="input-label">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</label>
                        <input type="tel" id="settingsPhone" class="input-field" value="" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä">
                    </div>
                    <div class="input-group">
                        <label class="input-label">–†–µ–≥–∏–æ–Ω (—Å—Ç—Ä–∞–Ω–∞)</label>
                        <select id="settingsCountry" class="input-select">
                            <option value="ru">–†–æ—Å—Å–∏—è</option>
                            <option value="tj">–¢–∞–¥–∂–∏–∫–∏—Å—Ç–∞–Ω</option>
                            <option value="kz">–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω</option>
                            <option value="uz">–£–∑–±–µ–∫–∏—Å—Ç–∞–Ω</option>
                        </select>
                    </div>
                    <button class="button" onclick="saveSettings()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </div>
            <div id="contactPage" class="page-content">
                <div class="back-button" onclick="showProfileMenu()"><i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥</div>
                <h2>üìû –°–≤—è–∑–∞—Ç—å—Å—è —Å –Ω–∞–º–∏</h2>
                <div class="card" id="contactInfo"></div>
            </div>
            <div id="prohibitedPage" class="page-content">
                <div class="back-button" onclick="showProfileMenu()"><i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥</div>
                <h2>üö´ –ó–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã</h2>
                <div class="card" id="prohibitedList"></div>
            </div>
        </div>
    </div>

    <div class="tab-bar">
        <div class="tab-item active" data-tab="home"><span class="tab-icon">üè†</span><span>–ì–ª–∞–≤–Ω–∞—è</span></div>
        <div class="tab-item" data-tab="services"><span class="tab-icon">üì¶</span><span>–£—Å–ª—É–≥–∏</span></div>
        <div class="tab-item" data-tab="calc"><span class="tab-icon">üßÆ</span><span>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</span></div>
        <div class="tab-item" data-tab="currency"><span class="tab-icon">üí±</span><span>–í–∞–ª—é—Ç–∞</span></div>
        <div class="tab-item" data-tab="profile"><span class="tab-icon">üë§</span><span>–ü—Ä–æ—Ñ–∏–ª—å</span></div>
    </div>

    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            const tg = window.Telegram?.WebApp;
            if (tg) {
                tg.expand();
                tg.ready();
            }

            const API_BASE = 'https://common-adara-goldendragon-845bca68.koyeb.app';
            
            const user = tg?.initDataUnsafe?.user;
            const USER_ID = user?.id;
            const customerCodeFromUrl = new URLSearchParams(window.location.search).get('code');

            let userData = {
                firstName: user?.first_name || '–ö–ª–∏–µ–Ω—Ç',
                customerCode: customerCodeFromUrl || 'GD-0000',
                balance: 0,
                ordersCount: 0,
                deliveredCount: 0,
                avatar: localStorage.getItem('userAvatar') || 'üë§',
                phone: localStorage.getItem('userPhone') || '',
                country: localStorage.getItem('userCountry') || 'ru'
            };
            let userOrders = [];
            let exchangeRates = [];

            async function loadUserData() {
                if (!USER_ID) return;
                try {
                    const res = await fetch(`${API_BASE}/api/user/${USER_ID}`);
                    if (res.ok) {
                        const data = await res.json();
                        userData.customerCode = data.customer_code;
                        userData.balance = data.balance;
                        userData.ordersCount = data.orders_count;
                        userData.deliveredCount = data.delivered_count;
                        userData.firstName = data.first_name || user?.first_name || '–ö–ª–∏–µ–Ω—Ç';
                        userData.phone = data.phone_number || '';
                    }
                } catch (e) {
                    console.warn('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è', e);
                }
            }

            async function loadOrders() {
                if (!USER_ID) return;
                try {
                    const res = await fetch(`${API_BASE}/api/orders/${USER_ID}`);
                    if (res.ok) {
                        const data = await res.json();
                        userOrders = data.orders;
                    }
                } catch (e) {
                    console.warn('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–∫–∞–∑–æ–≤', e);
                }
            }

            async function loadExchangeRates() {
                try {
                    const res = await fetch(`${API_BASE}/api/exchange_rates`);
                    if (res.ok) {
                        const data = await res.json();
                        exchangeRates = data.rates;
                    } else {
                        exchangeRates = [
                            { code: 'USD', flag: 'üá∫üá∏', name: 'USD', rate: 95 },
                            { code: 'RUB', flag: 'üá∑üá∫', name: 'RUB', rate: 1 },
                            { code: 'CNY', flag: 'üá®üá≥', name: 'CNY', rate: 13.5 },
                            { code: 'EUR', flag: 'üá™üá∫', name: 'EUR', rate: 105 },
                            { code: 'KZT', flag: 'üá∞üáø', name: 'KZT', rate: 0.21 },
                            { code: 'UZS', flag: 'üá∫üáø', name: 'UZS', rate: 0.0075 },
                            { code: 'TJS', flag: 'üáπüáØ', name: 'TJS', rate: 8.5 }
                        ];
                    }
                } catch (e) {
                    console.warn('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫—É—Ä—Å–æ–≤', e);
                    exchangeRates = [
                        { code: 'USD', flag: 'üá∫üá∏', name: 'USD', rate: 95 },
                        { code: 'RUB', flag: 'üá∑üá∫', name: 'RUB', rate: 1 },
                        { code: 'CNY', flag: 'üá®üá≥', name: 'CNY', rate: 13.5 },
                        { code: 'EUR', flag: 'üá™üá∫', name: 'EUR', rate: 105 },
                        { code: 'KZT', flag: 'üá∞üáø', name: 'KZT', rate: 0.21 },
                        { code: 'UZS', flag: 'üá∫üáø', name: 'UZS', rate: 0.0075 },
                        { code: 'TJS', flag: 'üáπüáØ', name: 'TJS', rate: 8.5 }
                    ];
                }
            }

            await Promise.all([loadUserData(), loadOrders(), loadExchangeRates()]);

            function calculateTotalToPay() {
                return userOrders
                    .filter(order => order.status === '–í –æ–±—Ä–∞–±–æ—Ç–∫–µ')
                    .reduce((sum, order) => sum + (order.price || 0), 0);
            }

            // –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ —É—Å–ª—É–≥ (–±–µ–∑ –∑–≤–µ–∑–¥–æ—á–µ–∫ –≤ —Ç–µ–∫—Å—Ç–µ)
            const services = [
                { 
                    icon: 'üì¶', 
                    title: '–§—É–ª—Ñ–∏–ª–º–µ–Ω—Ç', 
                    desc: '–ü–æ–ª–Ω—ã–π –∫–æ–º–ø–ª–µ–∫—Å —É—Å–ª—É–≥: –ø—Ä–∏—ë–º, —Ö—Ä–∞–Ω–µ–Ω–∏–µ, —É–ø–∞–∫–æ–≤–∫–∞, –æ—Ç–ø—Ä–∞–≤–∫–∞',
                    fullDesc: 'üì¶ –§—É–ª—Ñ–∏–ª–º–µ–Ω—Ç\n\n‚úÖ –ü—Ä–∏—ë–º –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –≥—Ä—É–∑–æ–≤\n‚úÖ –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞\n‚úÖ –§–æ—Ç–æ- –∏ –≤–∏–¥–µ–æ–æ—Ç—á—ë—Ç\n‚úÖ –ö–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—è –∑–∞–∫–∞–∑–æ–≤\n‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ –≤—Å–µ–º—É –º–∏—Ä—É\n‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞–º–∏\n\nüë§ –ú–µ–Ω–µ–¥–∂–µ—Ä: @fulfilment_manager\nüì± WhatsApp: +7 999 111 22 33\nüí¨ WeChat: gd_fulfill'
                },
                { 
                    icon: 'üöõ', 
                    title: '–ê–≤—Ç–æ –∫–∞—Ä–≥–æ', 
                    desc: '–û–ø—Ç–∏–º–∞–ª—å–Ω–æ –ø–æ —Ü–µ–Ω–µ', 
                    fullDesc: 'üöõ –ê–≤—Ç–æ –∫–∞—Ä–≥–æ\n\n‚úÖ –°—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏: 14-21 –¥–µ–Ω—å\n‚úÖ –≠–∫–æ–Ω–æ–º–∏—á–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç\n‚úÖ –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –∫—Ä—É–ø–Ω—ã—Ö –ø–∞—Ä—Ç–∏–π\n‚úÖ –î–æ—Å—Ç–∞–≤–∫–∞ "–æ—Ç –¥–≤–µ—Ä–∏ –¥–æ –¥–≤–µ—Ä–∏"\n\nüí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å: –æ—Ç 5$/–∫–≥\n\nüë§ –ú–µ–Ω–µ–¥–∂–µ—Ä: @auto_manager\nüì± WhatsApp: +7 999 234 56 78'
                },
                { 
                    icon: 'üìÑ', 
                    title: '–ë–µ–ª–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞', 
                    desc: '–° –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π', 
                    fullDesc: 'üìÑ –ë–µ–ª–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞\n\n‚úÖ –ü–æ–ª–Ω–æ–µ —Ç–∞–º–æ–∂–µ–Ω–Ω–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ\n‚úÖ –í—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç—Å—è\n‚úÖ –†–∞–±–æ—Ç–∞ —Å —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–º–∏ –ª–∏—Ü–∞–º–∏\n‚úÖ –ù–î–° –∏ –ø–æ—à–ª–∏–Ω—ã –≤–∫–ª—é—á–µ–Ω—ã\n\nüí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å: –æ—Ç 15$/–∫–≥\n\nüë§ –ú–µ–Ω–µ–¥–∂–µ—Ä: @white_manager\nüì± WhatsApp: +7 999 456 78 90'
                }, 
                                { 
                    icon: 'üöÜ', 
                    title: '–ñ–î –¥–æ—Å—Ç–∞–≤–∫–∞', 
                    desc: '–°—Ç–∞–±–∏–ª—å–Ω–æ –∏ –≤—ã–≥–æ–¥–Ω–æ', 
                    fullDesc: 'üöÜ –ñ/–î –¥–æ—Å—Ç–∞–≤–∫–∞\n\n‚úÖ –°—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏: 10-15 –¥–Ω–µ–π\n‚úÖ –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å\n‚úÖ –î–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä—ë–º–æ–≤\n‚úÖ –°—Ç–∞–±–∏–ª—å–Ω—ã–µ —Å—Ä–æ–∫–∏\n\nüí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å: –æ—Ç 7$/–∫–≥\n\nüë§ –ú–µ–Ω–µ–¥–∂–µ—Ä: @rail_manager\nüì± WhatsApp: +7 999 345 67 89'
                },               
                { 
                    icon: '‚úàÔ∏è', 
                    title: '–ê–≤–∏–∞ –¥–æ—Å—Ç–∞–≤–∫–∞', 
                    desc: '–ë—ã—Å—Ç—Ä–æ –∏ –Ω–∞–¥—ë–∂–Ω–æ', 
                    fullDesc: '‚úàÔ∏è –ê–≤–∏–∞ –¥–æ—Å—Ç–∞–≤–∫–∞\n\n‚úÖ –°—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏: 3-7 –¥–Ω–µ–π\n‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–æ —Ç—Ä–µ–∫-–Ω–æ–º–µ—Ä—É\n‚úÖ –°—Ç—Ä–∞—Ö–æ–≤–∫–∞ –≤–∫–ª—é—á–µ–Ω–∞\n‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç 1 –∫–≥\n\nüí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å: –æ—Ç 10$/–∫–≥\n\nüë§ –ú–µ–Ω–µ–¥–∂–µ—Ä: @avia_manager\nüì± WhatsApp: +7 999 123 45 67'
                },

                { 
                    icon: '‚ö°', 
                    title: '–≠–∫—Å–ø—Ä–µ—Å—Å –¥–æ—Å—Ç–∞–≤–∫–∞', 
                    desc: '–°—Ä–æ—á–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤', 
                    fullDesc: '‚ö° –≠–∫—Å–ø—Ä–µ—Å—Å –¥–æ—Å—Ç–∞–≤–∫–∞\n\n‚úÖ –°—Ä–æ–∫: 1-2 –¥–Ω—è\n‚úÖ –î–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏ –º–µ–ª–∫–∏—Ö –≥—Ä—É–∑–æ–≤\n‚úÖ –ö—É—Ä—å–µ—Ä—Å–∫–∞—è —Å–ª—É–∂–±–∞\n‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏\n\nüí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å: –æ—Ç 25$/–∫–≥\n\nüë§ –ú–µ–Ω–µ–¥–∂–µ—Ä: @express_manager\nüì± WhatsApp: +7 999 567 89 01'
                },
                { 
                    icon: 'üí∏', 
                    title: '–¢—Ä–∞–Ω—Å—Ñ–µ—Ä —Å—Ä–µ–¥—Å—Ç–≤', 
                    desc: '–û–ø–ª–∞—Ç–∞ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞–º', 
                    fullDesc: 'üí∏ –¢—Ä–∞–Ω—Å—Ñ–µ—Ä —Å—Ä–µ–¥—Å—Ç–≤\n\n‚úÖ –ü–µ—Ä–µ–≤–æ–¥—ã –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞–º –≤ –ö–∏—Ç–∞–µ\n‚úÖ –ö–æ–º–∏—Å—Å–∏—è 1%\n‚úÖ –ë—ã—Å—Ç—Ä—ã–µ –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏\n‚úÖ –†–∞–±–æ—Ç–∞–µ–º —Å —é–∞–Ω—è–º–∏, –¥–æ–ª–ª–∞—Ä–∞–º–∏, —Ä—É–±–ª—è–º–∏\n\nüí∞ –ö–æ–º–∏—Å—Å–∏—è: 1% –æ—Ç —Å—É–º–º—ã\n\nüë§ –ú–µ–Ω–µ–¥–∂–µ—Ä: @transfer_manager\nüì± WhatsApp: +7 999 678 90 12'
                },
                { 
                    icon: 'üè≠', 
                    title: '–°–∫–ª–∞–¥—ã –≤ –ö–∏—Ç–∞–µ', 
                    desc: '–ò—É, –ì—É–∞–Ω—á–∂–æ—É, –£—Ä—É–º—á–∏', 
                    fullDesc: 'üè≠ –°–∫–ª–∞–¥—ã –≤ –ö–∏—Ç–∞–µ\n\nüìç –°–∫–ª–∞–¥ –ò—É\n–ê–¥—Ä–µ—Å: ÊµôÊ±üÁúÅ‰πâ‰πåÂ∏ÇÂõΩÈôÖÂïÜË¥∏Âüé, ‰πâ‰πå, 322000\n–£—Å–ª–æ–≤–∏—è: –º–∏–Ω. –≤–µ—Å 5 –∫–≥, –ø—Ä–∏—ë–º–∫–∞ 0.5$/–∫–≥, —Ö—Ä–∞–Ω–µ–Ω–∏–µ 3 –¥–Ω—è –±–µ—Å–ø–ª–∞—Ç–Ω–æ\n–ú–µ–Ω–µ–¥–∂–µ—Ä: +86 123 4567 8901\n\nüìç –°–∫–ª–∞–¥ –ì—É–∞–Ω—á–∂–æ—É\n–ê–¥—Ä–µ—Å: ÂπøÂ∑ûÂ∏ÇÁôΩ‰∫ëÂå∫Êú∫Âú∫Ë∑Ø, ÂπøÂ∑û, 510000\n–£—Å–ª–æ–≤–∏—è: –º–∏–Ω. –≤–µ—Å 10 –∫–≥, –ø—Ä–∏—ë–º–∫–∞ 0.3$/–∫–≥, —Ö—Ä–∞–Ω–µ–Ω–∏–µ 5 –¥–Ω–µ–π –±–µ—Å–ø–ª–∞—Ç–Ω–æ\n–ú–µ–Ω–µ–¥–∂–µ—Ä: +86 123 4567 8902\n\nüìç –°–∫–ª–∞–¥ –£—Ä—É–º—á–∏\n–ê–¥—Ä–µ—Å: Êñ∞ÁñÜ‰πåÈ≤ÅÊú®ÈΩêÂ∏ÇÁªèÊµéÂºÄÂèëÂå∫, ‰πåÈ≤ÅÊú®ÈΩê, 830000\n–£—Å–ª–æ–≤–∏—è: –º–∏–Ω. –≤–µ—Å 3 –∫–≥, –ø—Ä–∏—ë–º–∫–∞ 0.4$/–∫–≥, —Ö—Ä–∞–Ω–µ–Ω–∏–µ 7 –¥–Ω–µ–π –±–µ—Å–ø–ª–∞—Ç–Ω–æ\n–ú–µ–Ω–µ–¥–∂–µ—Ä: +86 123 4567 8903'
                },
                { 
                    icon: 'üõçÔ∏è', 
                    title: '–í—ã–∫—É–ø —Ç–æ–≤–∞—Ä–∞', 
                    desc: '–ü–æ–∏—Å–∫ –∏ –≤—ã–∫—É–ø –Ω–∞ 1688, Taobao', 
                    fullDesc: 'üõçÔ∏è –í—ã–∫—É–ø —Ç–æ–≤–∞—Ä–∞\n\n–ù–∞—Ö–æ–¥–∏–º –ª—É—á—à–∏—Ö –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤, –ø—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞—á–µ—Å—Ç–≤–æ, –≤—ã–∫—É–ø–∞–µ–º –∏ –¥–æ—Å—Ç–∞–≤–ª—è–µ–º.',
                    paymentOptions: [
                        { name: 'üîç –ü–æ–∏—Å–∫ –ø–æ —Ñ–æ—Ç–æ', description: '–ù–∞–π–¥—ë–º —Ç–æ–≤–∞—Ä –ø–æ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏, –ø—Ä–æ–≤–µ—Ä–∏–º –Ω–∞–ª–∏—á–∏–µ', price: 500 },
                        { name: 'üîó –ü–æ–∏—Å–∫ –ø–æ URL', description: '–ü—Ä–æ–≤–µ—Ä–∏–º –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞, –∫–∞—á–µ—Å—Ç–≤–æ, –æ—Ç–∑—ã–≤—ã', price: 1000 },
                        { name: 'üìã –ü–æ–ª–Ω—ã–π –ø–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–∞', description: '–ü–æ–¥–±–æ—Ä –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä–∞, –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–±—Ä–∏–∫–∏, —Ç–µ—Å—Ç–æ–≤—ã–π –æ–±—Ä–∞–∑–µ—Ü', price: 1500 }
                    ]
                },
                { 
                    icon: '‚úàÔ∏è', 
                    title: '–ë–∏–∑–Ω–µ—Å —Ç—É—Ä', 
                    desc: '–ë–∏–∑–Ω–µ—Å —Ç—É—Ä –ø–æ –≤—Å–µ–º—É –ö–∏—Ç–∞—é', 
                    fullDesc: '‚úàÔ∏è –ë–∏–∑–Ω–µ—Å —Ç—É—Ä –ø–æ –ö–∏—Ç–∞—é\n\n‚úÖ –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –¥–µ–ª–æ–≤—ã—Ö –ø–æ–µ–∑–¥–æ–∫\n‚úÖ –ü–æ—Å–µ—â–µ–Ω–∏–µ –≤—ã—Å—Ç–∞–≤–æ–∫ (Canton Fair –∏ –¥—Ä.)\n‚úÖ –ò–Ω—Å–ø–µ–∫—Ü–∏—è —Ñ–∞–±—Ä–∏–∫\n‚úÖ –í—Å—Ç—Ä–µ—á–∏ —Å –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞–º–∏\n‚úÖ –ü–æ–ª–Ω–æ–µ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ, –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫, —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä\n‚úÖ –ü–æ–º–æ—â—å —Å –≤–∏–∑–æ–π –∏ –±–∏–ª–µ—Ç–∞–º–∏\n\nüë§ –ú–µ–Ω–µ–¥–∂–µ—Ä: @tour_manager\nüì± WhatsApp: +7 999 789 01 23\nüí¨ WeChat: china_tour'
                },
                { 
                    icon: 'üöó', 
                    title: '–ü–æ–∏—Å–∫ –∞–≤—Ç–æ', 
                    desc: '–ü–æ–¥–±–æ—Ä –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π –≤ –ö–∏—Ç–∞–µ', 
                    fullDesc: 'üöó –ü–æ–∏—Å–∫ –∞–≤—Ç–æ\n\n‚úÖ –ü–æ–º–æ–∂–µ–º –Ω–∞–π—Ç–∏ –∏ –∫—É–ø–∏—Ç—å –∞–≤—Ç–æ–º–æ–±–∏–ª—å –≤ –ö–∏—Ç–∞–µ\n‚úÖ –ü–æ–ª–Ω–æ–µ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ —Å–¥–µ–ª–∫–∏\n‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª—è\n‚úÖ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Å–ø–µ–∫—Ü–∏—è\n‚úÖ –î–æ—Å—Ç–∞–≤–∫–∞ –≤ –†–§\n‚úÖ –†–∞—Å—Ç–∞–º–æ–∂–∫–∞ –ø–æ–¥ –∫–ª—é—á\n\nüí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å —É—Å–ª—É–≥–∏: –æ—Ç 30000‚ÇΩ\n\nüë§ –ú–µ–Ω–µ–¥–∂–µ—Ä: @auto_search\nüì± WhatsApp: +7 999 890 12 34'
                },
                { 
                    icon: 'üîç', 
                    title: '–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å', 
                    desc: '–ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –≥—Ä—É–∑–æ–º', 
                    fullDesc: 'üîç –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å\n\n‚úÖ Online‚Äë–æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –Ω–∞ –≤—Å–µ—Ö —ç—Ç–∞–ø–∞—Ö –¥–æ—Å—Ç–∞–≤–∫–∏\n‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞\n‚úÖ –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç —Å –∏—Å—Ç–æ—Ä–∏–µ–π –∑–∞–∫–∞–∑–æ–≤\n‚úÖ –§–æ—Ç–æ- –∏ –≤–∏–¥–µ–æ–æ—Ç—á—ë—Ç—ã\n‚úÖ –ö—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞\n\nüë§ –ú–µ–Ω–µ–¥–∂–µ—Ä: @track_manager\nüì± WhatsApp: +7 999 901 23 45'
                }
            ];
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å–µ—Ç–∫—É —É—Å–ª—É–≥ (–≤—Å–µ –∫—Ä–æ–º–µ —Ñ—É–ª—Ñ–∏–ª–º–µ–Ω—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π —É–∂–µ –µ—Å—Ç—å)
            const servicesGrid = document.getElementById('servicesGrid');
            services.forEach(s => {
                if (s.title === '–§—É–ª—Ñ–∏–ª–º–µ–Ω—Ç') return; // –§—É–ª—Ñ–∏–ª–º–µ–Ω—Ç —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω –∫–∞–∫ featured
                
                const card = document.createElement('div');
                card.className = 'service-card';
                card.innerHTML = `
                    <div class="service-icon">${s.icon}</div>
                    <div class="service-title">${s.title}</div>
                    <div class="service-desc">${s.desc}</div>
                `;
                card.addEventListener('click', () => showServiceDetail(s.title));
                servicesGrid.appendChild(card);
            });

            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Ñ—É–ª—Ñ–∏–ª–º–µ–Ω—Ç–∞
            document.getElementById('fulfillmentService').addEventListener('click', function() {
                showServiceDetail('–§—É–ª—Ñ–∏–ª–º–µ–Ω—Ç');
            });

            // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± —É—Å–ª—É–≥–µ
            window.showServiceDetail = function(title) {
                const service = services.find(s => s.title === title);
                if (!service) return;
                
                document.getElementById('servicesList').style.display = 'none';
                document.getElementById('serviceDetail').style.display = 'block';
                document.getElementById('servicesBackButton').style.display = 'flex';
                
                document.getElementById('serviceDetailTitle').innerText = title;
                document.getElementById('serviceDetailDesc').innerHTML = service.fullDesc.replace(/\n/g, '<br>');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–ø—Ü–∏–∏ –æ–ø–ª–∞—Ç—ã —Ç–æ–ª—å–∫–æ –¥–ª—è "–í—ã–∫—É–ø —Ç–æ–≤–∞—Ä–∞"
                const paymentOptionsDiv = document.getElementById('servicePaymentOptions');
                if (service.paymentOptions) {
                    let optionsHtml = '<h3 style="margin: 0 0 16px 0; color: var(--text-color);">–í—ã–±–µ—Ä–∏—Ç–µ —É—Å–ª—É–≥—É:</h3>';
                    service.paymentOptions.forEach(option => {
                        optionsHtml += `
                            <div class="payment-option-button" onclick="orderService('${service.title}', '${option.name}', ${option.price})">
                                <div class="payment-option-title">
                                    <span>${option.name}</span>
                                    <span class="payment-option-price">${option.price} ‚ÇΩ</span>
                                </div>
                                <div class="payment-option-desc">${option.description}</div>
                            </div>
                        `;
                    });
                    paymentOptionsDiv.innerHTML = optionsHtml;
                    paymentOptionsDiv.style.display = 'block';
                } else {
                    paymentOptionsDiv.style.display = 'none';
                }
            };
            
            // –§—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫ —Å–ø–∏—Å–∫—É —É—Å–ª—É–≥
            window.showServicesList = function() {
                document.getElementById('servicesList').style.display = 'block';
                document.getElementById('serviceDetail').style.display = 'none';
                document.getElementById('servicesBackButton').style.display = 'none';
            };
            
            // –§—É–Ω–∫—Ü–∏—è –∑–∞–∫–∞–∑–∞ —É—Å–ª—É–≥–∏
            window.orderService = function(serviceTitle, optionName, price) {
                if (userData.balance < price) {
                    alert(`‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤. –ë–∞–ª–∞–Ω—Å: ${userData.balance} ‚ÇΩ, –Ω—É–∂–Ω–æ: ${price} ‚ÇΩ`);
                    // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –ø—Ä–æ—Ñ–∏–ª—å –¥–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è
                    document.querySelector('.tab-item[data-tab="profile"]').click();
                    showProfilePage('accountPage');
                    return;
                }
                
                if (confirm(`–ó–∞–∫–∞–∑–∞—Ç—å "${optionName}" –∑–∞ ${price} ‚ÇΩ?`)) {
                    // –ó–¥–µ—Å—å –±—É–¥–µ—Ç API-–∑–∞–ø—Ä–æ—Å –¥–ª—è —Å–ø–∏—Å–∞–Ω–∏—è —Å—Ä–µ–¥—Å—Ç–≤
                    userData.balance -= price;
                    updateUserUI();
                    alert(`‚úÖ –£—Å–ª—É–≥–∞ "${optionName}" –∑–∞–∫–∞–∑–∞–Ω–∞! –° –≤–∞—à–µ–≥–æ –±–∞–ª–∞–Ω—Å–∞ —Å–ø–∏—Å–∞–Ω–æ ${price} ‚ÇΩ`);
                    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ —Å–ø–∏—Å–∫—É —É—Å–ª—É–≥
                    showServicesList();
                }
            };

            const pickupPoints = {
                ru: ['–ú–æ—Å–∫–≤–∞, —É–ª. –¢–≤–µ—Ä—Å–∫–∞—è, 1', '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥, –ù–µ–≤—Å–∫–∏–π –ø—Ä., 22', '–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫, –ö—Ä–∞—Å–Ω—ã–π –ø—Ä., 50'],
                tj: ['–î—É—à–∞–Ω–±–µ, –ø—Ä. –†—É–¥–∞–∫–∏, 10', '–•—É–¥–∂–∞–Ω–¥, —É–ª. –õ–µ–Ω–∏–Ω–∞, 5'],
                kz: ['–ê–ª–º–∞—Ç—ã, –ø—Ä. –ê–±–∞—è, 100', '–ù—É—Ä-–°—É–ª—Ç–∞–Ω, —É–ª. –ö–∞–±–∞–Ω–±–∞–π –±–∞—Ç—ã—Ä–∞, 15'],
                uz: ['–¢–∞—à–∫–µ–Ω—Ç, —É–ª. –ê–º–∏—Ä–∞ –¢–µ–º—É—Ä–∞, 30', '–°–∞–º–∞—Ä–∫–∞–Ω–¥, —É–ª. –†–µ–≥–∏—Å—Ç–∞–Ω, 2']
            };

            const contacts = {
                phone: '+7 (800) 123-45-67',
                email: 'support@golden-dragon.com',
                workTime: '–ü–Ω-–ü—Ç 9:00-21:00 –ú–°–ö',
                chat: '@goldendragon_support'
            };

            const prohibitedItems = [
                '–û—Ä—É–∂–∏–µ –∏ –±–æ–µ–ø—Ä–∏–ø–∞—Å—ã',
                '–ù–∞—Ä–∫–æ—Ç–∏—á–µ—Å–∫–∏–µ –≤–µ—â–µ—Å—Ç–≤–∞',
                '–í–∑—Ä—ã–≤—á–∞—Ç—ã–µ –≤–µ—â–µ—Å—Ç–≤–∞',
                '–Ø–¥–æ–≤–∏—Ç—ã–µ –∏ —Ä–∞–¥–∏–æ–∞–∫—Ç–∏–≤–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã',
                '–î—Ä–∞–≥–æ—Ü–µ–Ω–Ω—ã–µ –º–µ—Ç–∞–ª–ª—ã –≤ —Å–ª–∏—Ç–∫–∞—Ö',
                '–ñ–∏–≤—ã–µ –∂–∏–≤–æ—Ç–Ω—ã–µ (–∫—Ä–æ–º–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–π)',
                '–°–∫–æ—Ä–æ–ø–æ—Ä—Ç—è—â–∏–µ—Å—è –ø—Ä–æ–¥—É–∫—Ç—ã –±–µ–∑ —É–ø–∞–∫–æ–≤–∫–∏',
                '–ê–ª–∫–æ–≥–æ–ª—å –∏ —Ç–∞–±–∞–∫ —Å–≤–µ—Ä—Ö –Ω–æ—Ä–º—ã',
                '–õ–µ–∫–∞—Ä—Å—Ç–≤–∞ –±–µ–∑ —Ä–µ—Ü–µ–ø—Ç–∞',
                '–î–µ–Ω—å–≥–∏ –∏ —Ü–µ–Ω–Ω—ã–µ –±—É–º–∞–≥–∏'
            ];

            const customerCodeEl = document.getElementById('customerCode');
            const greetingEl = document.getElementById('greeting');
            const balanceEl = document.getElementById('balance');
            const ordersCountEl = document.getElementById('ordersCount');
            const deliveredCountEl = document.getElementById('deliveredCount');
            const totalToPayEl = document.getElementById('totalToPay');
            const profileNameEl = document.getElementById('profileName');
            const profileCodeEl = document.getElementById('profileCode');
            const profileAvatarEl = document.getElementById('profileAvatar');
            const settingsAvatarEl = document.getElementById('settingsAvatar');
            const accountBalanceEl = document.getElementById('accountBalance');
            const settingsNameEl = document.getElementById('settingsName');
            const settingsPhoneEl = document.getElementById('settingsPhone');
            const settingsCountryEl = document.getElementById('settingsCountry');

            function updateUserUI() {
                greetingEl.innerText = `üëã –ü—Ä–∏–≤–µ—Ç, ${userData.firstName}!`;
                customerCodeEl.innerText = userData.customerCode;
                balanceEl.innerText = userData.balance + ' ‚ÇΩ';
                ordersCountEl.innerText = userData.ordersCount;
                deliveredCountEl.innerText = userData.deliveredCount;
                totalToPayEl.innerText = calculateTotalToPay() + ' $';
                profileNameEl.innerText = userData.firstName;
                profileCodeEl.innerText = userData.customerCode;
                profileAvatarEl.innerText = userData.avatar;
                settingsAvatarEl.innerText = userData.avatar;
                accountBalanceEl.innerText = userData.balance + ' ‚ÇΩ';
                settingsNameEl.value = userData.firstName;
                settingsPhoneEl.value = userData.phone;
                settingsCountryEl.value = userData.country;

                document.querySelectorAll('.avatar-option').forEach(opt => {
                    opt.classList.toggle('selected', opt.dataset.avatar === userData.avatar);
                });
            }

            function renderCurrencyTables() {
                const mainCurrencies = exchangeRates.filter(c => ['USD', 'RUB', 'CNY'].includes(c.code));
                const ratesTable = document.getElementById('currencyRatesTable');
                if (mainCurrencies.length) {
                    ratesTable.innerHTML = mainCurrencies.map(c => 
                        `<tr><td><span class="currency-flag">${c.flag}</span> ${c.name}</td><td>${(c.rate * 0.98).toFixed(2)}</td><td>${(c.rate * 1.02).toFixed(2)}</td></tr>`
                    ).join('');
                } else {
                    ratesTable.innerHTML = '<tr><td colspan="3">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</td></tr>';
                }

                const allRatesTable = document.getElementById('allRatesTable');
                if (exchangeRates.length) {
                    allRatesTable.innerHTML = exchangeRates.map(c => 
                        `<tr><td><span class="currency-flag">${c.flag}</span> ${c.name}</td><td>${(c.rate * 0.98).toFixed(4)}</td><td>${(c.rate * 1.02).toFixed(4)}</td></tr>`
                    ).join('');
                } else {
                    allRatesTable.innerHTML = '<tr><td colspan="3">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</td></tr>';
                }

                const fromSelect = document.getElementById('fromCurrency');
                const toSelect = document.getElementById('toCurrency');
                if (exchangeRates.length) {
                    fromSelect.innerHTML = exchangeRates.map(c => `<option value="${c.rate}" data-code="${c.code}">${c.flag} ${c.code}</option>`).join('');
                    toSelect.innerHTML = exchangeRates.map(c => `<option value="${c.rate}" data-code="${c.code}">${c.flag} ${c.code}</option>`).join('');
                    const usd = exchangeRates.find(c => c.code === 'USD');
                    const eur = exchangeRates.find(c => c.code === 'EUR');
                    if (usd) fromSelect.value = usd.rate;
                    if (eur) toSelect.value = eur.rate;
                }
                updateConverter();
            }

            const tabs = document.querySelectorAll('.tab-item');
            const contents = {
                home: document.getElementById('homeTab'),
                services: document.getElementById('servicesTab'),
                calc: document.getElementById('calcTab'),
                currency: document.getElementById('currencyTab'),
                profile: document.getElementById('profileTab')
            };
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.dataset.tab;
                    tabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    Object.values(contents).forEach(c => c.classList.remove('active'));
                    if (contents[tabId]) contents[tabId].classList.add('active');
                    
                    // –ü—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –Ω–∞ –≤–∫–ª–∞–¥–∫—É —É—Å–ª—É–≥ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫
                    if (tabId === 'services') {
                        showServicesList();
                    }
                    if (tabId === 'profile') showProfileMenu();
                });
            });

            window.showProfileMenu = function() {
                document.querySelectorAll('#profileTab .page-content').forEach(p => p.classList.remove('active'));
                document.getElementById('profileMenu').classList.add('active');
            };
            window.showProfilePage = function(pageId) {
                document.querySelectorAll('#profileTab .page-content').forEach(p => p.classList.remove('active'));
                document.getElementById(pageId).classList.add('active');
            };
            window.showBalanceRecharge = function() {
                showProfilePage('rechargePage');
            };
            window.rechargeBalance = async function() {
                const amount = parseFloat(document.getElementById('rechargeAmount').value);
                if (!amount || amount <= 0) {
                    alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É');
                    return;
                }
                try {
                    const response = await fetch(`${API_BASE}/api/balance/update`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ telegram_id: USER_ID, amount: amount })
                    });
                    if (response.ok) {
                        const data = await response.json();
                        userData.balance = data.new_balance;
                        updateUserUI();
                        alert(`‚úÖ –ë–∞–ª–∞–Ω—Å –ø–æ–ø–æ–ª–Ω–µ–Ω –Ω–∞ ${amount} ‚ÇΩ`);
                        showProfilePage('accountPage');
                    } else {
                        alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–∏');
                    }
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è:', e);
                    alert('‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è');
                }
            };

            document.querySelectorAll('[data-page]').forEach(el => {
                el.addEventListener('click', function() {
                    const page = this.dataset.page;
                    if (page === 'calculator') {
                        document.querySelector('.tab-item[data-tab="calc"]').click();
                        return;
                    }
                    showProfilePage(page + 'Page');
                    if (page === 'pickup') {
                        const points = pickupPoints[userData.country] || pickupPoints.ru;
                        document.getElementById('pickupList').innerHTML = points.map(p => `<div>üìç ${p}</div>`).join('');
                    } else if (page === 'contact') {
                        document.getElementById('contactInfo').innerHTML = `
                            üìû –¢–µ–ª–µ—Ñ–æ–Ω: ${contacts.phone}<br>
                            üìß Email: ${contacts.email}<br>
                            ‚è∞ –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã: ${contacts.workTime}<br>
                            üí¨ –ß–∞—Ç: ${contacts.chat}
                        `;
                    } else if (page === 'prohibited') {
                        document.getElementById('prohibitedList').innerHTML = prohibitedItems.map(i => `<div>üö´ ${i}</div>`).join('');
                    } else if (page === 'orders') {
                        const ordersList = document.getElementById('ordersList');
                        if (userOrders.length) {
                            ordersList.innerHTML = userOrders.map(o => `
                                <div style="background:var(--secondary-bg-color); border-radius:12px; padding:12px; margin-bottom:8px;">
                                    <div style="display:flex; justify-content:space-between; align-items:center;">
                                        <span style="font-family:monospace; font-weight:600;">${o.track_code}</span>
                                        <span style="color:${o.status === '–î–æ—Å—Ç–∞–≤–ª–µ–Ω' ? '#4CAF50' : '#FFC107'}; font-weight:600;">${o.status}</span>
                                    </div>
                                    <div style="display:flex; justify-content:space-between; margin-top:8px;">
                                        <span>üí∞ –°—É–º–º–∞: $${o.price || 0}</span>
                                        <span style="color:var(--hint-color); font-size:12px;">${o.date ? new Date(o.date).toLocaleDateString() : ''}</span>
                                    </div>
                                </div>
                            `).join('');
                        } else {
                            ordersList.innerHTML = '<div class="card">–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤</div>';
                        }
                    }
                });
            });

            document.getElementById('myOrdersBtn').addEventListener('click', () => {
                document.querySelector('.tab-item[data-tab="profile"]').click();
                showProfilePage('ordersPage');
            });

            const showRatesBtn = document.getElementById('showRatesBtn');
            const showConverterBtn = document.getElementById('showConverterBtn');
            const ratesSection = document.getElementById('ratesSection');
            const converterSection = document.getElementById('converterSection');
            showRatesBtn.addEventListener('click', () => {
                showRatesBtn.classList.add('active');
                showConverterBtn.classList.remove('active');
                ratesSection.style.display = 'block';
                converterSection.style.display = 'none';
            });
            showConverterBtn.addEventListener('click', () => {
                showConverterBtn.classList.add('active');
                showRatesBtn.classList.remove('active');
                ratesSection.style.display = 'none';
                converterSection.style.display = 'block';
            });

            function updateConverter() {
                const fromAmount = parseFloat(document.getElementById('fromAmount').value) || 0;
                const fromRate = parseFloat(document.getElementById('fromCurrency').value) || 1;
                const toRate = parseFloat(document.getElementById('toCurrency').value) || 1;
                const result = (fromAmount * fromRate) / toRate;
                document.getElementById('toAmount').value = result.toFixed(2);
                const fromCode = document.getElementById('fromCurrency').selectedOptions[0]?.dataset.code || '?';
                const toCode = document.getElementById('toCurrency').selectedOptions[0]?.dataset.code || '?';
                document.getElementById('converterRate').innerText = `1 ${fromCode} = ${(fromRate / toRate).toFixed(4)} ${toCode}`;
            }
            document.getElementById('fromAmount').addEventListener('input', updateConverter);
            document.getElementById('fromCurrency').addEventListener('change', updateConverter);
            document.getElementById('toCurrency').addEventListener('change', updateConverter);
            updateConverter();

            window.calculateDelivery = function() {
                const country = document.getElementById('deliveryCountry').value;
                const goodsType = parseFloat(document.getElementById('goodsType').value) || 1;
                const weight = parseFloat(document.getElementById('weight').value) || 0;
                const volume = parseFloat(document.getElementById('volume').value) || 0;
                const cargoValue = parseFloat(document.getElementById('cargoValue').value) || 0;
                const method = document.getElementById('deliveryMethod').value;
                const insuranceChecked = document.getElementById('insurance').checked;

                let basePrice = 5;
                if (country === 'tj') basePrice = 6;
                else if (country === 'kz') basePrice = 4.5;
                else if (country === 'uz') basePrice = 5.5;

                let methodCoeff = 1;
                if (method === 'avia') methodCoeff = 2;
                else if (method === 'rail') methodCoeff = 1.2;

                let total = weight * basePrice * goodsType * methodCoeff + volume * 20;
                if (insuranceChecked) {
                    total += cargoValue * 0.01;
                }
                document.getElementById('calcResult').innerHTML = `üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å: ${total.toFixed(2)} $`;
            };

            window.selectAvatar = function(avatar) {
                userData.avatar = avatar;
                localStorage.setItem('userAvatar', avatar);
                document.querySelectorAll('.avatar-option').forEach(opt => opt.classList.remove('selected'));
                event.target.classList.add('selected');
                profileAvatarEl.innerText = avatar;
                settingsAvatarEl.innerText = avatar;
            };

            window.saveSettings = function() {
                const newName = settingsNameEl.value.trim();
                const newPhone = settingsPhoneEl.value.trim();
                const newCountry = settingsCountryEl.value;
                if (newName) {
                    userData.firstName = newName;
                    localStorage.setItem('userName', newName);
                }
                if (newPhone) {
                    userData.phone = newPhone;
                    localStorage.setItem('userPhone', newPhone);
                }
                userData.country = newCountry;
                localStorage.setItem('userCountry', newCountry);
                updateUserUI();
                alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
                showProfileMenu();
            };

            renderCurrencyTables();
            updateUserUI();
        });
    </script>
</body>
</html>